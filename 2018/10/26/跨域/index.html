<!DOCTYPE html>
<html lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  
  <meta name="keywords" content="月魂的博客">
  <meta name="description" content="前端工程师">
  
  <title>月影</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/materialize.min.css">
    
      <link rel="stylesheet" href="/css/main.min.css">
    
  
  <style type="text/css">
      html{
          font-family: sans-serif;
          font-weight: 300;
      }
      @font-face {
          font-family: 'Material Icons';
          font-style: normal;
          font-weight: 400;
          src: url(/fonts/MaterialIcons-Regular.eot);
          src: url(/fonts/MaterialIcons-Regular.woff2) format('woff2'),
          url(/fonts/MaterialIcons-Regular.woff) format('woff'),
          url(/fonts/MaterialIcons-Regular.ttf) format('truetype')
      }
  </style>
</head>
<body>
<div id="menu-box"><a href="javascript:void(0)" id="menu" data-activates="slide-out" class="button-collapse menu"><span class="nav-btn"></span></a></div>
<div id="menu-outer">
  <div id="menu-inner">
      <ul id="slide-out" class="side-nav">
    <div class="nav-header" style="background-image: url(/images/header-bg.png);background-color:#26A69A">
    <div class="header-box"><img src="/images/header.jpg" ondragstart="return false;"></div>
    <p>Wang Ying</p>
    <div class="nav-link">
        
        
        <a href="https://github.com/guessDeveloper" target="_blank"><div class="link-box github"></div></a>
        
        
        <a href="mailto:http://15932632612.@163com"><div class="link-box email"></div></a>
        
        
        <a href="http://example.com" target="_blank"><div class="link-box weibo"></div></a>
        
        
    </div>
    <div class="nav-search">
        <form id="search-form"> <!-- 搜索框相关 -->
            <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索..." class="search form-control" autocomplete="off" autocorrect="off">
            <div class="nav-search-img"><i class="material-icons">search</i></div>
        </form>
        <div id="local-search-result"></div> <!-- 搜索结果区 -->
        <p class="no-result">无搜索结果</p>
    </div>
</div>
    <!--Homepage-->

<li class="nav-list">
    <a href="/" target="_self">
        <div class="nav-ico"><i class="material-icons">home</i> </div><p>主页</p>
    </a>
</li>

<!--archives-->

<li class="nav-list dropdown-btn">
    <a class target="_self">
        <div class="nav-ico"><i class="material-icons">assignment</i></div><p>归档</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown">
    <li class="nav-dropdown-list">
        <a class="archive-link" href="/archives/2021/06/">June 2021<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/10/">October 2020<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/08/">August 2020<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/04/">April 2020<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2019/12/">December 2019<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2018/10/">October 2018<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/11/">November 2017<span class="archive-count">4</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/10/">October 2017<span class="archive-count">4</span></a>
    </li>
</ul>
<!--categories-->

<li class="nav-list dropdown-btn">
    <a class target="_self">
        <div class="nav-ico"><i class="material-icons">dashboard</i></div><p>分类</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown">
    <li class="nav-dropdown-list">
        <a class="category-link" href="/categories/css/">css<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/js/">js<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/vue/">vue<span class="category-count">3</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/网络/">网络<span class="category-count">8</span></a>
    </li>
</ul>
<!--tags-->

<li class="nav-list">
    <a href="/archives" target="_self">
        <div class="nav-ico"><i class="material-icons">bookmark</i> </div><p>标签</p>
    </a>
</li>

<!--photo-->

<!--friends-->

<!--about-->


</ul>

  </div>
</div>

<div id="content-outer">
  <div id="content-inner">
    
<article id="post">
  <div class="post-page-title" style="background-color:#26A69A;background-image:url(/images/random/vateral-12.png)">
  <h2>跨域</h2>
    
  <p>作者:Wang Ying &nbsp&nbsp 发布于:<time datetime="2018-10-26T09:29:56.000Z">
          2018-10-26
    </time>
  </p>
    
  </div>
  <div class="post-page-content">
  <h3 id="跨域通信的方式"><a href="#跨域通信的方式" class="headerlink" title="跨域通信的方式"></a>跨域通信的方式</h3><ul>
<li>JSONP</li>
<li>CORS</li>
<li>Hash</li>
<li>postMessage</li>
<li>WebSoket</li>
</ul>
<h3 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h3><ul>
<li>端口相同</li>
<li>域名相同</li>
<li>协议相同</li>
</ul>
<p>例子：<code>http://www.example.com/dir/page.html</code> 这个网址，协议是<code>http</code>，域名是<code>www.example.com</code>，端口是<code>80</code></p>
<p>同源政策的目的，是为了保证用户信息的安全，防止恶意的网站窃取数据。<strong>是浏览器做的努力</strong></p>
<h3 id="同源策略限制范围"><a href="#同源策略限制范围" class="headerlink" title="同源策略限制范围"></a>同源策略限制范围</h3><ul>
<li>Cookie、LocalStorage 和 IndexDB 无法读取<ul>
<li>DOM 无法获得</li>
<li>AJAX 请求不能发送</li>
</ul>
</li>
</ul>
<h3 id="CROS跨域资源请求"><a href="#CROS跨域资源请求" class="headerlink" title="CROS跨域资源请求"></a>CROS跨域资源请求</h3><p>CORS(Cross-origin resource sharing)跨域资源请求</p>
<p>浏览器在请求一个跨域资源的时候，如果是跨域的Ajax请求，他会在请求头中加一个<code>origin</code>字段，但他是不知道这个资源服务端是否允许跨域请求的。浏览器会发送到服务端，如果服务器返回的头中没有<code>&#39;Access-Control-Allow-Origin&#39;: &#39;对应网址或 * &#39;</code> 的话，那么浏览器就会把请求内容给忽略掉，并且在控制台报错</p>
<h3 id="CORS限制"><a href="#CORS限制" class="headerlink" title="CORS限制"></a>CORS限制</h3><p>允许的请求方法</p>
<ul>
<li>GET</li>
<li>POST </li>
<li>HEAD</li>
</ul>
<p>允许的Content-Type</p>
<ul>
<li>text/plain</li>
<li>multipart/form-data</li>
<li>application/x-www-form-ulencoded</li>
</ul>
<p>什么是CORS跨域请求的简单请求和非简单请求<br>同时满足两大条件，就属于简单请求<br>请求方式：GET、POST、HEAD（注：什么是HEAD请求？HEAD请求和GET本质是一样的，但是HEAD请求不含数据，只有HTTP头部信息）<br>HTTP头部信息不超过一下几种字段：无自定义头部字段、Accept、Accept-Language、Content-Language、Last-Event-ID、Content-Type（只有三个值application/x-www-form-urlencoded、multipart/form-data、text/plain）<br>非简单请求<br>请求方式：PUT、DELETE<br>自定义头部字段<br>发送json格式数据<br>正式通信之前，浏览器会先发送OPTION请求，进行预检，这一次的请求称为“预检请求”<br>服务器成功响应预检请求后，才会发送真正的请求，并且携带真实数据</p>
<p>其他类型的请求方法和Content-Type需要通过<strong>预请求验证</strong>后然后才能发送<br>由于出现跨域的问题，所以服务端需要设置同意任意跨源请求：<br>Access-Control-Allow-Origin: *<br>服务端的”OPTION-预检”里边一定要包含允许客户端使用非简单方式请求数据的响应头：<br>预检”请求时，允许请求方式则需服务器设置响应头：Access-Control-Request-Method<br>预检”请求时，允许请求头则需服务器设置响应头：Access-Control-Request-Headers<br>预检”缓存时间，服务器设置响应头：Access-Control-Max-Age<br>检查Origin、Access-Control-Request-Method和Access-Control-Request-Headers字段以后，确认允许跨源请求<br>服务端同意预检请求，客户端会发送真正的请求；服务端不同意预检请求，因此触发一个错误，返回到客户端</p>
<h3 id="CORS预请求"><a href="#CORS预请求" class="headerlink" title="CORS预请求"></a>CORS预请求</h3><p>跨域资源共享标准新增了一组 HTTP 首部字段，允许服务器声明哪些源站有权限访问哪些资源。另外，规范要求，对那些可能对服务器数据产生副作用的 HTTP 请求方法（特别是 GET 以外的 HTTP 请求，或者搭配某些 MIME 类型的 POST 请求），浏览器必须首先使用 OPTIONS 方法发起一个预检请求。</p>
<p>服务器在HTTP header中加入允许请求的方法和Content-Type后，其他指定的方法和Content-Type就可以成功请求了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&apos;Access-Control-Allow-Headers&apos;: &apos;允许Content-Type&apos;</span><br><span class="line">&apos;Access-Control-Allow-Methods&apos;: &apos;允许的请求方法&apos;</span><br><span class="line">&apos;Access-Control-Max-Age&apos;: &apos;预请求允许其他方法和类型传输的时间&apos;</span><br></pre></td></tr></table></figure></p>
<h3 id="JSONP跨域"><a href="#JSONP跨域" class="headerlink" title="JSONP跨域"></a>JSONP跨域</h3><p>浏览器上虽然有同源限制，但是像 srcipt标签、link标签、img标签、iframe标签，这种<strong>在标签上通过src地址来加载一些内容的时候浏览器是允许进行跨域请求的</strong>。 </p>
<p>所以JSONP的原理就是：</p>
<ul>
<li>创建一个script标签，这个script标签的src就是请求的地址；</li>
<li>这个script标签插入到DOM中，浏览器就根据src地址访问服务器资源</li>
<li>返回的资源是一个文本，但是因为是在script标签中，浏览器会执行它</li>
<li>而这个文本恰好是函数调用的形式，即函数名（数据），浏览器会把它当作JS代码来执行即调用这个函数</li>
<li>只要提前约定好这个函数名，并且这个函数存在于window对象中，就可以把数据传递给处理函数。</li>
</ul>
<h3 id="Hash值跨域通信"><a href="#Hash值跨域通信" class="headerlink" title="Hash值跨域通信"></a>Hash值跨域通信</h3><p>背景：在页面A下提供iframe或frame嵌入了跨域的页面B</p>
<p>容器页面 -&gt; 嵌入页通信：</p>
<p>在A页面中改变B的url中的hash值，B不会刷新，但是B可以用过<code>window.onhashchange</code>事件监听到hash变化</p>
<h3 id="postMessage通信"><a href="#postMessage通信" class="headerlink" title="postMessage通信"></a>postMessage通信</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 窗口A中</span></span><br><span class="line"><span class="built_in">window</span>.postMessage(<span class="string">'data'</span>, <span class="string">'http://A.com'</span>);</span><br><span class="line"><span class="comment">// 窗口B中</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event.origin);    <span class="comment">// http://A.com</span></span><br><span class="line">  <span class="built_in">console</span>.log(event.source);    <span class="comment">// A 对象window引用</span></span><br><span class="line">  <span class="built_in">console</span>.log(event.data);      <span class="comment">// 数据</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="WebSoket-跨域通信"><a href="#WebSoket-跨域通信" class="headerlink" title="WebSoket 跨域通信"></a>WebSoket 跨域通信</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">'wss://echo.websoket.org'</span>) <span class="comment">//这个是后端端口</span></span><br><span class="line"></span><br><span class="line">ws.onopen = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  ws.send(<span class="string">'some message'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(evt.data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ws.onclose = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'连接关闭'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="document-domain"><a href="#document-domain" class="headerlink" title="document.domain"></a>document.domain</h3><p>该方式只能用于二级域名相同的情况下，比如 a.test.com 和 b.test.com 适用于该方式。</p>
<p>只需要给页面添加 document.domain = ‘test.com’ 表示二级域名都相同就可以实现跨域</p>

  </div>
  <!--评论块-->
    
  <div id="disqus_thread" style="padding:30px;text-align: center;border-top:1px solid silver " data-diaque="https://guessdeveloper.github.io/"><button style="margin: 0 auto;background-color:#26A69A " class="btn" onclick="disqus()">加载评论(被墙则无法加载)</button></div>

  <script>

      /**
       *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
       *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
      /*
       var disqus_config = function () {
       this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
       this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
       };
       */
      function disqus() { // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script'),v = d.createElement('script'),disquUrl=document.getElementById("disqus_thread").dataset.diaque;
          v.id = 'dsq-count-scr'
          v.src= '//'+disquUrl+'/count.js';
          s.src = 'https://'+disquUrl+'/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(v);
          (d.head || d.body).appendChild(s);
      }
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    

</article>
<nav class="post-nav">
  <!-- Prev Nav -->
    
  <a href="/2019/12/06/手机端白屏问题/" id="post_nav-newer" class="post-nav-content prev-content">
      新篇
  </a>
    


  <!-- Next Nav -->
    
  <a href="/2018/10/25/缓存/" id="post_nav-older" class="post-nav-content next-content">
      旧篇
  </a>
    
</nav>
<div class="post-toc-btn"><i class="material-icons">format_list_numbered</i></div>
<div class="post-toc-none"><p>(无)</p></div>
<div class="post-toc-box">
    <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#跨域通信的方式"><span class="post-toc-number">1.</span> <span class="post-toc-text">跨域通信的方式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#同源策略"><span class="post-toc-number">2.</span> <span class="post-toc-text">同源策略</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#同源策略限制范围"><span class="post-toc-number">3.</span> <span class="post-toc-text">同源策略限制范围</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CROS跨域资源请求"><span class="post-toc-number">4.</span> <span class="post-toc-text">CROS跨域资源请求</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CORS限制"><span class="post-toc-number">5.</span> <span class="post-toc-text">CORS限制</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CORS预请求"><span class="post-toc-number">6.</span> <span class="post-toc-text">CORS预请求</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#JSONP跨域"><span class="post-toc-number">7.</span> <span class="post-toc-text">JSONP跨域</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Hash值跨域通信"><span class="post-toc-number">8.</span> <span class="post-toc-text">Hash值跨域通信</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#postMessage通信"><span class="post-toc-number">9.</span> <span class="post-toc-text">postMessage通信</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#WebSoket-跨域通信"><span class="post-toc-number">10.</span> <span class="post-toc-text">WebSoket 跨域通信</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#document-domain"><span class="post-toc-number">11.</span> <span class="post-toc-text">document.domain</span></a></li></ol>
</div>
<!--<div class="post-back"><i class="material-icons">arrow_back</i></div>-->
<script type="text/javascript">
    menu();
</script>
  </div>
</div>
<div id="bottom-outer">
  <div id="bottom-inner">
    <a id="top-button" onfocus="this.blur();"><div class="up upinbody" style="background-color:#26A69A"><i class="material-icons material-up">vertical_align_top</i></div></a>


<p>Copyright ©  2017  月影</p>
<!--<p >Powered by <a href="https://hexo.io/" target="_blank"> Hexo </a> & Theme - <a href="https://github.com/moumao/hexo-theme-Vateral" target="_blank">Vateral</a></p>-->
<p style="font-size: 10px" id="footer-times" data-time="1/1/2017 00:00:00"></p>
<script>
    var beginTime=document.getElementById("footer-times").dataset.time
    function show_date_time(){
        var span=document.getElementById("footer-times")
        window.setTimeout("show_date_time()", 1000);
        BirthDay=new Date(beginTime);//初始日期
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        e_hrsold=(e_daysold-daysold)*24;
        hrsold=Math.floor(e_hrsold);
        e_minsold=(e_hrsold-hrsold)*60;
        minsold=Math.floor((e_hrsold-hrsold)*60);
        seconds=Math.floor((e_minsold-minsold)*60);
        span.innerHTML="本站已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
    }
    show_date_time();
</script>

<div class="post-music">
    <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=498861&auto=0&height=66"></iframe>
</div>
  </div>
</div>

<!--影集界面需要的资源-->



<!-- scripts list from theme config.yml -->

<script src="/js/jquery-3.1.1.min.js"></script>

<script src="/js/materialize.min.js"></script>

<script src="/js/main.min.js"></script>


<script>
    NProgress.start();
    NProgress.done();
    lazy();
    links();
    window.onpopstate = menu();
    //pjax操作
    $(document).pjax('a:not(.nopjax)', '#content-inner', {fragment:'#content-inner', timeout:8000});
    $(document).on('pjax:start', NProgress.start).on('pjax:end', NProgress.done)
        .on('pjax:end', () => {
            dowmdiv();
            lazy();
            toc();
            links();
            menu();
        });
</script>

</body>
</html>
