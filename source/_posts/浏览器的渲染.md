---
title: '浏览器的渲染'
date: 2017-10-25 17:29:56
tags: html
---

看了一篇文章，说的是浏览器的渲染的过程及其原理，前端工作中许多工作都在对页面进行优化，每个优化的目的不同所需要的方案也不一样。所以了解浏览器渲染的原理及过程对一个前端来说重要性可想而知。

![浏览器](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1508934122586&di=68ff7e230d4561ec14ea460ae3231955&imgtype=0&src=http%3A%2F%2Fstatic.leiphone.com%2Fuploads%2F2011%2F06%2Fcommon-web-browsers-and-browser1.jpeg)

##### 关键渲染路径

>关键渲染路径(Critical Rendering Path) 是指与用户当前操作相关的内容。例如用户刚刚打开一个界面，首屏的显示就是当前用户操作相关的内容，具体就是浏览器收到HTML、CSS和JavaScript等资源对其进行处理从而渲染出Web页面。
了解浏览器的渲染也是为了优化关键渲染路径。优化是针对具体问题的解决方案。所以优化没有准确的规定。

##### 浏览器渲染页面的过程

浏览器请求、加载、渲染一个页面总共做了5件事情。

1. DNS查询
2. TCP链接
3. HTTP请求即响应
4. 服务器响应
5. 客户端渲染

我们今天主要讨论的是客户端渲染，而其又分为5步。

1. 处理HTML标记并构建DOM树。
2. 处理CSS标记并构建CSSOM树。
3. 将DOM与CSSOM合并成一个渲染树。
4. 根据渲染树来布局，移计算每个节点的几何信息。
5. 将各个节点绘制在屏幕上。

但是呢，这5步不是一次性顺序完成的。如果有DOM或者CSSOM被修改，以上过程需要重复执行，这样才能计算出哪些像素需要在屏幕上进行重新渲染。在实际中，css与JavaScript往往多次修改DOM和CSSOM。

##### 阻塞渲染：CSS与JavaScript

提到资源阻塞，我们要明白一点，现在的浏览器是并行加载资源的。例如当HTML解析器（HTML Parser）被脚步阻塞时，解析器虽然会停止构建DOM,但仍会识别该脚步后面的资源，并进行预加载。
同时，由于下面两点：

1. 默认情况下，CSS被视为阻塞渲染的资源，这意味着浏览器将不会渲染任何已处理的内容，直至CSSOM构建完毕。
2. JavaScript不仅可以读取和修改DOM属性，还可以读取和修改CSSOM属性。

存在阻塞的CSS资源时，浏览器会延迟javascript的执行和DOM构建。另外：

1. 当浏览器遇到一个script标签时,DOM构建将暂停，直至脚步完成执行。
2. JavaScript可以查询和修改DOM与CSSOM。
3. CSSOM构建时，JavaScript执行将暂停，直至CSSOM就绪。

所以，script的位置很重要。实际中，遵循以下规则。

1. CSS优先：引入顺序上，CSS资源优先于JavaScript资源。
2. JavaScript尽量减少DOM操作。

##### CSS

```
<style>p{color:red;}</style>
<link rel='stylesheet' href='index.css'>
```
这样的link标签会被视为阻塞渲染的资源，浏览器会优先处理这些CSS资源，直至CSSOM构建完成。
渲染树（Render-Tree）的关键渲染路径中，要求同时具有CSSOM和DOM,之后才构建渲染树。也就是说CSS和HTML都是阻塞资源，但是HTML是必须的，所以我们想做优化只能从CSS上想办法。
